---
title: "모바일(AOS)진단 11 - 인텐트 취약점 진단"
categories:
  - 모바일(AOS)
tags:
  - 모바일(AOS)
---


>   **인텐트 상세 내용** <br>

인텐트란? 안드로이드에서 컴포넌트에게 무엇을 하라고 전달하는 메시지 (단말 내부 통신 관점에서 백엔드API와 다른 개념 + DB처럼 데이터를 보관하는 저장소가 아니고 메시지(패킷)처럼 전달하는 수단)<br>
즉, 행동(Action) + 데이터(Data)를 실어 나르는 전송 객체

엑스트라(Extra)란? Intent안에 붙이는 부가 데이터 묶음<br>
Intent<br>
 ├─ action<br>
 ├─ component<br>
 ├─ flags<br>
 └─ extras  (데이터)<br>
      ├─ "name" : String<br>
      ├─ "age"  : int<br>
      └─ "isLogin" : boolean<br>

인텐트 유형<br>
-명시적 인텐트(Explicit Intent) : 실행할 컴포넌트를 정확히 지정한 인텐트<br>
-암시적 인텐트(Implicit Intent) : 구체적인 대상 없이 '이런 작업을 할 수 있는 앱'을 요청하는 인텐트<br>



```

Intent myIntent = new Intent(this, secondActivity.class);

Button button = findViewById(R.id.button);          // XML에 있는 버튼을 자바로 가져옴
    button.setOnClickListener(new View.OnClickListener(){       // 버튼 클릭 이벤트 리스너(액티비티x, 이벤트를 수신하기위한 인터페이스=이벤트 처리 객체) 등록
        @Override
        public void onClick(View view){
            startActivity(myIntent);        // 화면 전환 발생(secondActivity) (처리로직) 
        }
    });
```

앱에서 인텐트를 사용하고 있으며, 수신할 수 있는 인텐트를 안드로이드 운영체제에 알릴려면 매니페스트 파일 내 인텐트 필터 태그를 사용하여 각 앱 구성요소에 대해 하나 이상의 인텐트 필터를 선언
각 인텐트 필터는 인텐트의 작업, 데이터 및 카테고리를 기반으로 어느 유형의 인텐트를 수락하는지 지정
안드로이드 시스템은 앱의 매니페스트 파일에 선언된 인텐트 필터와 일치하는 경우에 인텐트를 해당 앱으로 전달함

```
메인 액티비티에서 Intent로 데이터를 담아 서브 액티비티로 전달
public class MainActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);   // 액티비티 생성 시 가장 먼저 호출되는 메서드
        setContentView(R.layout.activity_main);   // activity_main.xml 레이아웃을 현재 액티비티 화면으로 설정
        Button gobtn = (Button) findViewById(R.id.intentbtn1);    // 버튼 객체를 XML에서 id로 찾아서 가져옴

        gobtn.setOnClickListener(new View.OnClickListener() {    // 버튼 클릭 이벤트 리스너 등록
            @Override
            public void onClick(View v) {   // 버튼이 클릭되었을 때 실행되는 코드 블록
                EditText editText =
                        (EditText) findViewById(R.id.editTextTextPersonName);

                String myname = editText.getText().toString();

                // Intent 객체 생성 (현재 앱의 Context와 이동할 대상 액티비티(SubActivity)를 지정)
                Intent myIntent =
                        new Intent(getApplicationContext(), SubActivity.class);

                myIntent.putExtra("name", myname);    // name키에 사용자가 입력한 이름 저장
                myIntent.putExtra("address", "서울시 영등포구 OO로");   // address키에 문자열 데이터 저장
                myIntent.putExtra("msg", "환영할 메시지를 담습니다.");    // msg키에 메시지 문자열 저장

                startActivity(myIntent);    // Intent를 이용하여 SubActivity 실행
            }
        });
    }
}
```


>   **브로드캐스트 리시버 상세 내용** <br>

브로드캐스트 리시버란? 시스템이나 앱에서 발생한 이벤트를 수신해서 반응하는 컴포넌트<br>
안드로이드 운영체제 또는 앱이 외부에 메시지를 전송하는 시스템으로 설치된 모든 앱이 이 메시지를 수신 가능<br>
예를 들어 안드로이드 시스템의 상태 변화부터 앱에서 특정 이벤트 발생 시마다 불특정 다수 앱에게 브로드캐스트를 전송 할 수 있음<br>

브로드캐스트 이벤트를 수신하기 위해서는 먼저 리시버 클래스를 생성한 후 AndroidManifest.xml에 리시버를 등록함. 시스템에서 특정 이벤트가 발생할 때마다 선언한 리시버 클래스가 호출됨<br>
앱이 브로드캐스트 리시버를 등록하는 방법에는 앱의 매니페스트에 등록하는 정적 브로드캐스트 리시버와 registerReceiver API 호출을 사용하여 앱 코드에 동적으로 등록하는 동적 브로드캐스트 리시버 방법<br>

브로드캐스트 리시버 유형<br>
-정적 브로드캐스트 리시버 : AndroidManifest.xml 내 receiver요소 선언 <br>
    즉, AndroidManifest.xml에 등록되어, 앱이 실행 중이 아니어도 방송을 수신하는 리시버 (주로 시스템 이벤트를 처리하는데 사용)<br>
<br>
-동적 브로드캐스트 리시버 : 소스코드 내 registerReceiver 호출로 사용, unregisterReceiver 호출로 해제<br>
    즉, 앱 실행중인 Activity나 Service 살아있을 때만 동작<br>

    


>   **컨텐트 프로바이더 상세 내용** <br>

컨텐트 프로바이더란? 현재 앱이 가지고 있는 정보를 다른 앱에게 공유하는 컴포넌트<br>
예를 들어 메신저 앱에서 연락처 앱의 컨텐트 프로바이더를 이용하여 이름과 전화번호 등을 가져옴<br>

AndroidManifest.xml파일의 provider태그 → 컨텐트 프로바이더의 설정을 정의<br>
exported 속성 : 컨텍트 프로바이더가 다른 앱에 의해 접근될 수 있는지 결정<br>
ex. exported = true 설정은 다른 앱에 의해 접근 가능함을 의미<br>
    exported = false 설정은 내부적으로만 사용하며 외부 앱 접근을 제한함<br>

**외부에서의 호출은 허용되지 않은 앱이지만 명령의 실행 결과로 중요 정보가 반환되거나 데이터의 조작이 가능한 경우 취약으로 진단**

```

* 컨텐트 프로바이더를 사용하기 위해서는 컨텐트 식별자가 필요하며 컨텐트 식별자의 형식

content://<authority>/<path>/<id>

- content:// : 컨텐트 프로바이더임을 의미하는 스킴
- <authority> : 컨텐트 프로바이더의 이름, 메타데이터 파일에 선언된 이름과 일치하는 경우 해당 이름의 기능을 사용 (android:authorities="" 정의된 부분)
- <path> : 데이터의 경로, 데이터베이스 경우 테이블명 의미
- <id> : 경로 내의 특정 위치 지정, 데이터베이스 경우 특정 레코드 참조

PC > adb shell content query(컨텐츠 프로바이더의 조회 동작 시도) --uri <접근대상 ContentProvider 주소>
PC > adb shell content query --uri content://com.~~~~~~.fileprovider

```


>   **딥링크 상세 내용** <br>

딥링크란? 브로드캐스트 리시버와 컨텐트 프로바이더에서 아용한 스킴뿐만 아니라 개발자가 직접 앱에서 사용할 URI정의

scheme://path?parameter=value

1.exported=true 인가?<br>
2.인증 없이 실행되는가?<br>
3.파라미터 검증이 있는가?<br>
4.WebView / Native 기능 호출로 이어지는가?<br>
5.사용자 의도 확인이 있는가?<br>



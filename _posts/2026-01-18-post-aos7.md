---
title: "모바일(AOS)진단 7 - 단말 취약점 진단 (액티비티 강제 실행)"
categories:
  - 모바일(AOS)
tags:
  - 모바일(AOS)
---

>   **액티비티 강제 실행 상세 내용 및 취약점** <br>

<br>
안드로이드 시스템은 액티비티별 생명주기에 따른 단계별 콜백 함수를 통해 앱 코드를 실행<br>
이때 선언된 콜백함수는 액티비티 클래스에서 관리됨 <br>
<br>
화면은 여러 액티비티로 구성(AndroidManifest.xml에 앱 구성 요소의 정보와 정의) -> Activity태그 속성을 적절하게 설정하지 않거나 액티비티 실행 시 정상 실행 여부를 검증하지 않으면 액티비티 강제 실행 취약점 발생할 수 있음<br>
<br>

 activity<br>
    android:name="com.~~~~~~~.MainActivity"<br>
    android:launchMode="singleTask"<br>
    android:exported="true">   // Activity 태그 내에 exported속성 값이 true로 설정되어 있어 해당 액티비티는 외부에 공개되어있음<br>
<br>
즉, 액티비티 강제 실행 취약점은 액티비티가 외부로 노출되어 있고 직접 호출이 가능하며, 각 액티비티가 시작할 때 이전 액티비티의 인증 절차가 구현되지 않으면 발생<br>    

<br>
<br>
**요즘 앱은 Activity를 거의 안 늘림 (Fragment 구조) -> 화면전환이 액티비티가 아니라 Fragment로 이뤄짐**<br>
MainActivity (1개)<br>
 ├─ LoginFragment<br>
 ├─ HomeFragment<br>
 ├─ OrderFragment<br>
 ├─ MyPageFragment<br>
 └─ WebViewFragment<br>
<br>
Fragment란 하나의 Activity 안에서 화면의 일부를 담당하는 UI 구성 단위(화면조각)
즉, 앱에 Activity는 여러 개 있어도, 실제 화면 전환은 Fragment로 이루어지는 경우가 많아서 dumpsys에는 항상 MainActivity만 보이는 것처럼 느껴진다.<br>
<br>

>   **보안대책** <br>

```

* 1.exported 속성 값을 false로 설정하는 것 
AndroidManifest.xml
 activity
    android:name=".PaymentActivity"
    android:exported="false" />    


* 2. 액티비티 적절한 권한 및 접근제어 로직 구현
public class PaymentActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        // 🔐 로그인 여부 확인
        if (!AuthManager.getInstance().isLoggedIn()) {
            // 인증되지 않은 접근 → 메인으로 리다이렉트
            finish();
            return;
        }

        setContentView(R.layout.activity_payment);
    }
```



---
title: "모바일(AOS)진단 3 - APK파일 추출 및 무결성 검증을 위한 디컴파일/리패키징(재서명)"
categories:
  - 모바일(AOS)
tags:
  - 모바일(AOS)
---


>   **APK파일 추출 방법** <br>

**`1.` Nox 통한 추출**<br>
Nox에뮬레이터 앱 길게 눌러 '추출'메뉴 선택<br>

<img src="/assets/images/icon/apk1.png"  style="display:block; margin:0 auto; width:60%; border:1px solid #000;"><br>
<br>

**`2.` 추출 앱을 이용한 추출**<br>
플레이스토어에서 '앱추출' 검색하여 설치 후, 추출할 앱 선택하고 추출하기<br>
- 추출한 앱은 /storage/emulated/0 경로에 저장됨<br>

<img src="/assets/images/icon/apk2.png"  style="display:block; margin:0 auto; width:60%; border:1px solid #000;"><br>
<img src="/assets/images/icon/apk3.png"  style="display:block; margin:0 auto; width:60%; border:1px solid #000;"><br>
<br>



>   **디컴파일/리패키징 정의 및 추출방법** <br>

*컴파일(Compile) : 소스코드를 기계어로 변환하는 과정 (고수준 언어 코드를 안드로이드 운영체제에서 실행할 수 있게 기계어로 변환)<br>
&nbsp;&nbsp;&nbsp;ㄴ Java/Kotlim -> .class 바이트코드 -> .dex(Dalvik 바이트코드) 변환(ART가 이해하는 포맷)  -> 패키징 및 서명통해서 APK<br>
<br>
<img src="/assets/images/icon/compile.png"  style="display:block; margin:0 auto; width:60%; border:1px solid #000;"><br>


*디컴파일(Decompile) : 컴파일의 반대 과정 (컴파일된 기계어 코드를 다시 원래 언어코드 수준으로 변환)<br>
&nbsp;&nbsp;&nbsp;ㄴ 디컴파일에서 Java 문법으로 표현못하는 경우도 있기에 실제 실행 분기를 보여주는 Smali 코드 확인필요 + smali에 존재하는 메서드/분기도 Frida로 직접 후킹할 수 있음<br>
<br>
<img src="/assets/images/icon/repackaging.png"  style="display:block; margin:0 auto; width:60%; border:1px solid #000;"><br>
<br>
<br>


>   **추출 및 재사명 방법** <br>

```
*추출 명령어*
java -jar apktool_2.12.1.jar d "추출할 APK"  (앱 이름은 왠만하면 영어로)
```

<img src="/assets/images/icon/test.png"  style="display:block; margin:0 auto; width:90%; border:1px solid #000;"><br>
<br>

```
*APK의 서명정보 확인*
cd C:\Users\woght\AppData\Local\Android\Sdk\build-tools\36.0.0
apksigner verify --verbose --print-certs "APK명"
```
<img src="/assets/images/icon/sign.png"  style="display:block; margin:0 auto; width:90%; border:1px solid #000;"><br>
<br>

```
*서명 키 생성(keytool -genkeypair)*
cd C:\Program Files\Java\jdk-22\bin
keytool -genkeypair -v  -keystore my.keystore  -alias mykey  -keyalg RSA  -keysize 2048  -sigalg SHA256withRSA  -validity 10000  -storepass rlawogh123.  -keypass rlawogh123.  -dname "CN=My Test,O=MyOrg,C=KR"

keytool -genkeypair -v     // 키 쌍 생성
 -keystore my.keystore     // 키 저장 파일
 -alias mykey              // 키 이름
 -keyalg RSA               // 키 알고리즘
 -keysize 2048             // 키 길이
 -sigalg SHA256withRSA     // 서명 알고리즘
 -validity 10000           // 인증서 유효기간
 -storepass rlawogh123. 
 -keypass rlawogh123. 
 -dname "CN=My Test,O=MyOrg,C=KR"  // 인증서 주체 정보


*키스토어 정보 확인
cd C:\Program Files\Java\jdk-22\bin
keytool -list -v -keystore [키스토어명]
```
<img src="/assets/images/icon/key.png"  style="display:block; margin:0 auto; width:90%; border:1px solid #000;"><br>
<br>

---
title: "모바일(AOS)진단 6 - 단말 취약점 진단 (백그라운드 화면 보호)"
categories:
  - 모바일(AOS)
tags:
  - 모바일(AOS)
---

>   **백그라운드 화면 보호 상세 내용 및 취약점** <br>

사용자가 홈 버튼을 누르거나 앱이 실행 중인 상태에서 다른 앱을 실행하여 백그라운드 모드로 전환되면 안드로이드는 현재 앱 액티비티의 스크린샷을 생성함<br> 
-> 민감한 정보를 표시하고 있는 경우, 스크린샷이 기록되어 작업관리자에 외부 노출로 이어질 수 있으므로 민감한 정보가 스크린샷에 포함하지 않도록 하여야함 

```
*백그라운드 이미지 저장 위치 (단말 종류나 버전에 따라 위치에 차이가 있을 수 있음)
ROOT # cd /data/system_ce/0/recent_images/
ROOT # cd /data/system_ce/0/snapshots/

*이미지 파일 임시 경로로 복사
cp [복사할 파일] [어디로 복사할지 위치]
cp /data/system_ce/0/snapshots/811.jpg /sdcard/Download/


*파일 추출
adb pull [단말기추출경로파일] [PC 어디로 추출할지]
adb pull /sdcard/Download/811.jpg  C:\Users\woght\OneDrive\Desktop
```


<img src="/assets/images/icon/snapshots.png"  style="display:block; margin:0 auto; width:90%; border:1px solid #000;"><br>



>   **보안대책** <br>

1. FLAG_SECURE플래그 설정
 FLAG_SECURE 플래그란 안드로이드 앱의 화면에 대한 플래그 중 하나로 화면을 보안 모드로 설정하는데 사용<br>
즉, 안드로이드에서 화면내용을 외부로 못 빼가게 막는 보안 플래그

@override
protected void onResume(){           
    super.onResume();               // 액티비티 포그라운드로 올라올 때

    // FLAG_SECURE 플래그 제거 (화면 캡처, 녹화, 미리보기 허용함) 
    getWindow().clearFlags(WindowManager.LayoutParams.FLAG_SECURE);  
}
@override
protected void onPause(){
    super.onPause();                // 액티비티 백그라운드로 전환될 때 호출

    // FLAG_SECURE 플래그 설정 (화면 캡처, 녹화, 미리보기 차단함) 
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_SECURE); 
}


❌ FLAG_SECURE만 쓰면
최근 앱 화면: 검은 화면

❌ 오버레이만 쓰면
스크린샷 가능, 화면 녹화 가능


2. FLAG_SECURE플래그 설정 + 오버레이 이미지  (가장 이상적)

// 화면 가림용 오버레이 View
// 최근 앱 미리보기 및 백그라운드 노출 방지 목적

private View secureOverlay;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    // 이 Activity의 화면은 항상 캡처/녹화 금지
    // → 스크린샷, 화면 녹화, adb screenrecord 차단
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_SECURE);

    // 화면 레이아웃 설정
    setContentView(R.layout.activity_main);

    // 오버레이 View 초기화
    secureOverlay = findViewById(R.id.secure_overlay);
}

@Override
protected void onResume() {
    super.onResume();

    // 앱이 포그라운드로 돌아오면
    // 실제 화면을 보여주기 위해 오버레이 제거
    secureOverlay.setVisibility(View.GONE);
}

@Override
protected void onPause() {
    super.onPause();

    // 앱이 백그라운드로 전환될 때
    // 최근 앱 미리보기 등에 실제 화면이 남지 않도록
    // 오버레이 화면을 표시
    secureOverlay.setVisibility(View.VISIBLE);
}
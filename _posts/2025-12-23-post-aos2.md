---
title: "모바일(AOS)진단 2 - 안드로이드 분석준비 및 apk파일 추출 방법, Burp인증서 등록방법, adb명령어 정리"
categories:
  - 모바일(AOS)
tags:
  - 모바일(AOS)
---


>   **정적분석과 동적분석** <br>

정적분석 : 소스코드 및 리소스 디컴파일 분석<br>
동적분석 : 앱 실행, 사용자 입력 등 앱 반응 관찰 <br>
<br>
개인적으로 정적 → 동적 → 모의공격 수행 → 상태변화 및 메모리 분석 순으로 수행하는 편<br>  
1. 정적 : 소스코드 디컴파일 분석, 매니페스트 파일 분석, 취약한 함수 및 하드코딩된 중요 정보 식별, 리패키징 통한 무결성 검증<br>  
2. 동적 : 단말기 로그 분석 준비, 프록시<br>  
3. 상태변화 및 메모리 분석 : 메모리 덤프, 변조 통한 메모리 누수, 민감데이터 평문 저장 <br>  
<br>  


>   **Burp Proxy 인증서 등록방법** <br>

**platform-tools  :  Google에서 제공하는 Android SDK(Software Development Kit/소프트웨어개발키트)의 핵심 도구 모음<br>     
	ㄴplatform-tools 이하 도구들		<br>
		1. adb   -  Android 디바이스와 PC 간의 명령어 통신을 가능하게 하는 도구<br>
		2. fastboot  -  부트로더 상태에서 기기 펌웨어를 플래싱할 수 있는 도구<br>
		3. dmtracedump, sqlite3, etc.   -   디버깅 및 시스템 분석 도구들<br>
    <br>
<img src="/assets/images/icon/sdk.png"  style="display:block; margin:0 auto; width:60%; border:1px solid #000;"><br>cf. 설치는 크롬 검색해서 설치가능<br>
---------------------------------------------------------------------------------------------------------------------------------
*adb(Android Debug Bridge)   :  (PC에서관건) 안드로이드 디바이스로 쉘 명령을 전송하거나, 앱 설치/삭제, 파일 전송, 로그 추적 등을 할 수 있는 도구<br>
  ㄴplatform-tools에서 adb명령어들 (관리자cmd)<br>
		adb devices  :	연결된 기기 리스트 확인<br>
		adb shell  :	기기 내 터미널 진입<br>
		adb push local remote  :	PC → Android 파일 전송<br>
		adb pull remote local  :	Android → PC 파일 추출<br>
		adb install myapp.apk  :	APK 앱 설치<br>
		adb logcat  :	실시간 로그 확인<br>
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**Burp proxy 인증서 등록 방법(모바일이 서버로 직접가는 대신, 먼저 PC를 프록시(중계자)로 지정하여 뜯어볼 수 있게) ->[아래]

( Android 7+ 정책으로 기본 미신뢰/ System CA에 강제 주입도 Android 10+의 APEX/서명 검증 때문에 난이도↑(재부팅 원복/롤백 위험) )
Android 7+ : 앱은 기본적으로 User CA 미신뢰 → 앱이 Network Security Config로 명시 허용해야 함.
Android 10+ : Conscrypt가 APEX 모듈로 분리되어 시스템 TLS/신뢰 저장소를 읽기 전용·서명 검증 체계로 관리(임의 수정 어려움).

[아래]
burp실행  -> http://burp접속해서 CA Certificate다운로드  -> cacert.der 파일 openssl-0.9.8e_X64\bin에 붙여넣기
( 다운받은 Burp인증서는 DER(바이너리) 형식  -> 신뢰 저장소 규칙: 때문에 루트CA(.../cacerts/)는 파일명이 해시.인덱스(~~.0)이어야하고, PEM(텍스트)형식이어야함 )

1.관리자cmd openssl-0.9.8e_X64\bin다운받은 경로들어가서 
 -> (1) openssl.exe x509 -inform DER -in cacert.der -out cacert.pem    // x509인증서에대해  DER ->PEM으로 변환

(2) openssl.exe x509 -inform PEM -subject_hash_old -in cacert.pem     //  루트CA파일명을 <해시>.0 요구 /  PEM형식 인증서에 대해해시 해시 출력(파일명) 
    openssl.exe x509 -inform PEM -subject_hash -in cacert.pem


2.  openssl-0.9.8e_X64\bin 경로(burp인증서 설치경로)에 <해시>.0 생성될 것임.  -> 이 변환된 인증서를 휴대폰에 넣음 (/sdacard/Download)

->이후 루팅된 안드로이드(10+)에서 Conscrypt APEX 안의 신뢰루트(cacerts)에 Burp CA를 넣어 전역 신뢰시키려는 절차 -> [아래2] 

[아래2]
adb shell 접속해서 아래 명령어 실행
(cf. /apex : 여러개의 시스템 핵심 모듈이 읽기전용으로 붙는 디렉터리


(3) setenforce 0      // SELinux(안드로이는SELinux) 모드를 Enforcing → Permissive 변경 (cf. 모드확인 명령어: getenforce)

(4) mount -o remount,exec /apex       // 재마운트 /apex경로에서 재마운트,프로그램으로 실행가능 옵션 지정(디렉터리 조작할거기때문에)

(5) cp -r -p /apex/com.android.conscrypt /apex/com.android.conscrypt-bak    //Conscrypt APEX의 현재 내용 백업해둠

(6) umount -l /apex/com.android.conscrypt      // Conscrypt APEX 마운트를 해제. (APEX는 원래 읽기 전용이므로 직접 수정x)

(7) rm -rf /apex/com.android.conscrypt      // 마운트 지점 빈 디렉터리 삭제(추후 백업본 붙여넣을 것)

(8) cp /sdcard/Download/9a5ba575.0 /apex/com.android.conscrypt-bak/cacerts/9a5ba575.0    // Burp CA(파일명은 subject_hash_old.0)를 백업본의 cacerts 에 주입

(9) killall zygote     // 프레임워크 재시작 (변경된 신뢰루트 인식)

(10) mv /apex/com.android.conscrypt-bak /apex/com.android.conscrypt   (백업본(안에 Burp CA를 추가한 것)을 원래 위치로 바꿔치기)
-> /apex/com.android.conscrypt는 시스템 핵심(Conscrypt/TLS 스택)이고, 그 “전체 디렉터리”를 mv로 갈아끼우면 프레임워크(zygote/system_server)가 바로 깨지거나 apexd 무결성 체크가 실패해서 재부팅될 수 있음. 계속 시도

3. 인증서 퍼미션 변경
(11) cd /apex/com.android.conscrypt/cacerts
(12) chmod 644 9a5ba575.0
(13) chown system:system 9a5ba575.0
// burp인증서 권한 및 소유자 변경

※폰꺼지면 인증서 사라질 수 있음. 다시해야됨


